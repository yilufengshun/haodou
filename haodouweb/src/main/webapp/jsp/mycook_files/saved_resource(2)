/*!2017-11-11 16:43:33 merge: js/center/center.js,js/center/enterprise.js,js/tools/common.page.js,js/tools/common.waterfall.js,js/recipe/album/add_recipe.js,js/recipe/center/recipe.js,js/center/center/side.js!*/
;(function($,undefined){var tpl='<div class="public_elastic_layer">'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript://" class="ico20 center_back_ground_close">&nbsp;</a>更换背景：</dt>'+'<dd>'+'<p class="pop_tags">&nbsp;&nbsp;</p>'+'<ul class="skin_ul mgt10"></ul>'+'<p></p>'+'<div class="bd_pagex min clearfix"></div>'+'<p></p>'+'</dd>'+'<dd class="atn tc">'+'<a title="保存" href="javascript:///" class="dbtn btn_green">保存</a>&nbsp;'+'<a title="取消" href="javascript:///" class="dbtn btn_gray center_back_ground_close">取消</a>'+'</dd>'+'</dl>'+'</div>';var enterpise_tpl='<div class="public_elastic_layer">'+'<form action="http://wo.haodou.com/enterprise.php?do=background" id="center_enterprise_form_4" method="post" enctype="multipart/form-data" target="center_enterprise_hidden_frame_4">'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript://" class="ico20 center_enterprise_back_ground_close">&nbsp;</a>上传自定义背景图片：</dt>'+'<dd>'+'<p class="pop_pmt clearfix">注：支持不超过2M的JPG、GIF、PNG图片上传。</p>'+'<ul class="pop_fm_box mgt10">'+'<li>'+'<h5>上传图片：</h5>'+'<div class="fc_box">'+'<div class="file_upload">'+'<input type="text" placeholder="请选择文件" maxlength="32" class="pop_inp wid200">'+'<span class="dbtn btn_gray">选择图片</span>'+'<p class="bg_hide_inp"><input type="file"  name="background_file" value="" id="enterprise_background_file"></p>'+'</div>'+'</div>'+'</li>'+'<li>'+'<h5>背景设置：</h5>'+'<div class="fc_box mgt5">'+'<label class="pdr10"><input type="checkbox" name="type[]" class="rdg" value="1">设置图片平铺</label>'+'<label class="pdr10"><input type="checkbox" name="type[]" class="rdg" value="2">锁定背景图片</label>'+'</div>'+'</li>'+'</ul>'+'</dd>'+'<dd class="atn tc">'+'<a title="完成" href="javascript:///" class="dbtn btn_green center_enterprise_back_ground_submit">完成</a> '+'<a title="取消" href="javascript:///" class="dbtn btn_gray center_enterprise_back_ground_close">取消</a>'+'</dd>'+'</dl>'+'</form>'+'<iframe id="center_enterprise_hidden_frame_4" name="center_enterprise_hidden_frame_4" src="about:blank" style="display:none"></iframe>'+'</div>';$("#center_enterprise_back_ground").click(function(){var user_id=hd.login.isLogin();if(!user_id){hd.login.showLogin();return false}hd.dialog.popup('_center_enterprise_back_ground',enterpise_tpl,true,function(tpl){$(tpl).find(".center_enterprise_back_ground_close").click(function(){var $temp=$("#center_header_back_ground_div"),type=parseInt($temp.attr('_type')),css='';if(!(type&1)){css=' no-repeat';$(tpl).find('input[name="type[]"]').eq(0).prop("checked",false)}else{$(tpl).find('input[name="type[]"]').eq(0).prop("checked",true)}css+=' center top';if(type&2){css+=' fixed';$(tpl).find('input[name="type[]"]').eq(1).prop("checked",true)}else{$(tpl).find('input[name="type[]"]').eq(1).prop("checked",false)}$temp.css("background","url("+$temp.attr("back_ground_src")+") "+css);hd.dialog.close('_center_enterprise_back_ground');$.getJSON('http://wo.haodou.com/enterprise.php?do=deleteTempBackground',function(data){});return false})},function(tpl){ajaxGetEnterpriseBackGround(tpl,user_id)})});function ajaxGetEnterpriseBackGround(tpl,user_id){$.getJSON('http://wo.haodou.com/enterprise.php?do=ajaxGetBackground',function(data){$(tpl).find('input[name="type[]"]').each(function(i){var $temp=$(this);if($temp.val()&data){$temp.prop("checked",true)}})});var $center_header_back_ground_div=$("#center_header_back_ground_div");$(tpl).find('input[name="type[]"]').each(function(i){var $this=$(this);$this.unbind("change").change(function(){var $background_image=$center_header_back_ground_div.css("background-image");var $background_repeat=$center_header_back_ground_div.css("background-repeat");$background_repeat=$background_repeat=='no-repeat'?'no-repeat':'';var $background_position=$center_header_back_ground_div.css("background-attachment");$background_position=$background_position=='fixed'?'fixed':'';var val=$this.val();if($this.prop("checked")){if('1'==val){$center_header_back_ground_div.css("background",$background_image+' center top '+$background_position)}else if('2'==val){$center_header_back_ground_div.css("background",$background_image+' '+$background_repeat+' center top fixed')}}else{if('1'==val){$center_header_back_ground_div.css("background",$background_image+' no-repeat center top '+$background_position)}else if('2'==val){$center_header_back_ground_div.css("background",$background_image+' '+$background_repeat+' center top')}}})});$(tpl).find(".center_enterprise_back_ground_submit").click(function(){var type=[],background_file=$("#enterprise_background_file").val();$(tpl).find('input[name="type[]"]').each(function(i){if($(this).prop("checked"))type.unshift(1);else type.unshift(0)});$.getJSON('http://wo.haodou.com/enterprise.php?do=ajaxSaveBackground',{'type':type,'background_file':background_file},function(data){if('1'==data['status']){$("#center_header_back_ground_div").attr('_type',data['data']['type']).attr('back_ground_src',data['data']['url']);hd.dialog.close()}else hd.dialog.alert(data['data']['msg'])})});$(tpl).find("#enterprise_background_file").change(function(){$(tpl).find(".file_upload .pop_inp").val($(this).val());$(tpl).find("#center_enterprise_form_4").submit()})}$("#center_back_ground").click(function(){var user_id=hd.login.isLogin();if(!user_id){hd.login.showLogin();return false}var cat_id=0;hd.dialog.popup('_center_back_ground',tpl,true,function(tpl){$(tpl).find(".center_back_ground_close").click(function(){var $temp=$("#center_header_back_ground_div");$temp.css("background","url("+$temp.attr("back_ground_src")+") no-repeat center top");hd.dialog.close();return false})},function(tpl){ajaxGetBackGround(cat_id,0,tpl,user_id)})});function ajaxGetBackGround(cat_id,page,tpl,user_id){$.getJSON('http://wo.haodou.com/'+user_id+'/setting/background/',{cat_id:cat_id,page:page},function(data){var cat='&nbsp;&nbsp;',img='',pages='';if('-1'==data['status']){hd.dialog.alert(data['msg']);return false}if(data['cur_cat_id']){cat_id=data['cur_cat_id']}if(data['cat']){var temp=data['cat'],icon={8:'<i class="ico12 new"> </i>'},class_name="",tmp_icon='';for(i in temp){class_name="",tmp_icon="";if(cat_id==i)class_name="sel ";if("undefined"!=typeof icon[i])tmp_icon=icon[i];cat+='<a class="'+class_name+'" title="'+temp[i]+'" cat_id="'+i+'" href="javascript:///">'+temp[i]+tmp_icon+'</a>'}}if(data['data']){var temp=data['data'];for(i in temp){if(i==data['cur_back_ground_id'])img+='<li class="sel" back_ground="'+i+'"><img alt="'+temp[i]['title']+'" src="'+temp[i]['thumb_img']+'"><p style="display:none;">'+temp[i]['title']+'</p></li>';else img+='<li back_ground="'+i+'"><img alt="'+temp[i]['title']+'" src="'+temp[i]['thumb_img']+'"><p style="display:none;">'+temp[i]['title']+'</p></li>'}}if(data['pages']){pages=data['pages']}$(tpl).find(".pop_tags").html(cat);$(tpl).find("ul.skin_ul").html(img);$(tpl).find(".bd_pagex").html(pages);var $li=$(tpl).find("ul.skin_ul li");$li.each(function(){$(this).unbind("click").bind("click",function(){$li.removeClass('sel');$(this).addClass('sel');var temp_back_ground=$(this).attr("back_ground");$("#center_header_back_ground_div").css("background","url("+data['data'][temp_back_ground]['img']+") no-repeat center top")})});$(tpl).find(".btn_green").unbind("click").click(function(){var back_ground=$(tpl).find("ul.skin_ul li.sel").eq(0).attr('back_ground');if(!back_ground){hd.dialog.alert('请选择背景图片');return false}$.getJSON('http://wo.haodou.com/'+user_id+'/setting/background/',{cat_id:cat_id,back_ground:back_ground},function(data){if(data['status']==1){$("#center_header_back_ground_div").css("background","url("+data['img']+") no-repeat center top").attr('back_ground_src',data['img']);hd.dialog.close()}else if(data['status']<1){hd.dialog.alert(data['msg'])}return false})});$(tpl).find(".pop_tags a").each(function(){$(this).unbind("click").bind("click",function(){cat_id=$(this).attr('cat_id');ajaxGetBackGround(cat_id,1,tpl,user_id)})});$(tpl).find(".bd_pagex a").each(function(){$(this).unbind("click").bind("click",function(){ajaxGetBackGround(cat_id,$(this).attr('page'),tpl,user_id)})})})}var center_header_medal_time_out=null;$("#center_header_medal_btn").add($("#center_header_medal")).mouseover(function(){if(null!=center_header_medal_time_out)clearTimeout(center_header_medal_time_out);$("#center_header_medal_btn").addClass("hover");$('#center_header_medal').show()}).mouseout(function(){center_header_medal_time_out=setTimeout(function(){$("#center_header_medal_btn").removeClass("hover");$('#center_header_medal').hide()},120)});var center_change_avatar_time_out=null;$("#center_avatar").add("#center_change_avatar").hover(function(){if(null!=center_change_avatar_time_out)clearTimeout(center_change_avatar_time_out);$("#center_change_avatar").show()},function(){center_change_avatar_time_out=setTimeout(function(){$("#center_change_avatar").hide()},120)})})(jQuery);(function($,undefined){var tpl='<div class="public_elastic_layer">'+'<form id="center_enterprise_form" action="http://wo.haodou.com/enterprise.php" enctype="multipart/form-data" method="post" target="center_enterprise_hidden_frame_1" >'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript://" class="ico20 center_enterprise_colse">&nbsp;</a>增加一个模块：</dt>'+'<dd>'+'<p class="pop_pmt clearfix">注：以下选择项或填写项名称中，打<span class="red">*</span>为必填或必选项。</p>'+'<ul class="pop_fm_box mgt10">'+'<li>'+'<h5><span class="red">*</span> 选择类型：</h5>'+'<div class="fc_box">'+'<div class="sele">'+'<div>'+'<select id="center_enterprise_model_type" name="type">'+'<option value="1">图片</option>'+'<option value="2">视频</option>'+'<option value="3">文字</option>'+'</select>'+'</div>'+'</div>'+'<span class="fl mgt5 red" id="center_enterprise_img_info">图片的宽度是210px，高度不限！</span>'+'</div>'+'</li>'+'<li class="center_enterprise_main"></li>'+'</ul>'+'</dd>'+'<dd class="atn tc">'+'<a title="完成" href="javascript:///" class="dbtn btn_green">完成</a> '+'<a title="取消" href="javascript:///" class="dbtn btn_gray center_enterprise_colse">取消</a>'+'</dd>'+'</dl>'+'<iframe id="center_enterprise_hidden_frame_1" name="center_enterprise_hidden_frame_1" src="about:blank" style="display:none"></iframe>'+'</form>'+'</div>';var img_tpl='<li class="center_enterprise_main">'+'<h5><span class="red">*</span> 上传文件：</h5>'+'<div class="fc_box">'+'<div class="file_upload"><input id="center_enterprise_upload_file" type="text" placeholder="请选择文件" class="pop_inp wid200"><span class="dbtn btn_gray">选择图片</span><p class="bg_hide_inp"><input type="file" name="file" /></p></div>'+'</div>'+'</li>'+'<li class="center_enterprise_main">'+'<h5>设置链接：</h5>'+'<div class="fc_box">'+'<input type="text" placeholder="设置链接地址" name="link" class="pop_inp">'+'</div>'+'</li>';var video_tpl='<li class="center_enterprise_main">'+'<h5><span class="red">*</span> 视频地址：</h5>'+'<div class="fc_box">'+'<input type="text" placeholder="设置视频地址" name="link" class="pop_inp">'+'</div>'+'</li>';var text_tpl='<li class="center_enterprise_main">'+'<h5><span class="red">*</span> 填写文案：</h5>'+'<div class="fc_box">'+'<textarea placeholder="请填写文本" class="pop_inp hgt50" name="desc" id="enterprise_desc"></textarea>'+'</div>'+'</li>'+'<li class="center_enterprise_main">'+'<h5>设置链接：</h5>'+'<div class="fc_box">'+'<input type="text" placeholder="设置链接地址" name="link" class="pop_inp">'+'</div>'+'</li>';$("#center_add_model_btn").click(function(){var user_id=hd.login.isLogin();if(!user_id){hd.login.showLogin();return false}hd.dialog.popup('_center_enterprise_model',tpl,true,function(tpl){$(tpl).find(".center_enterprise_colse").click(function(){hd.dialog.close('_center_enterprise_model');return false});$(tpl).find("#center_enterprise_model_type").change(function(){var type=$(this).val();switch(type){case'1':$(tpl).find(".center_enterprise_main").replaceWith(function(index){if(index==0)return img_tpl;else return''});$(tpl).find("#center_enterprise_img_info").show();$(tpl).find("input[type='file']").unbind("change").change(function(){$(tpl).find("#center_enterprise_upload_file").val($(this).val())});break;case'2':$(tpl).find(".center_enterprise_main").replaceWith(function(index){if(index==0)return video_tpl;else return''});$(tpl).find("#center_enterprise_img_info").hide();break;case'3':$(tpl).find(".center_enterprise_main").replaceWith(function(index){if(index==0)return text_tpl;else return''});$(tpl).find("#center_enterprise_img_info").hide();break;default:alert('非法操作')}});$(tpl).find("#center_enterprise_model_type").change()},function(tpl){doEnterpriseModel(tpl,user_id)})});function doEnterpriseModel(tpl,user_id){$(tpl).find(".btn_green").click(function(){var $t=$(this);if($t.hasClass("btn_gray"))return false;var type=$(tpl).find("#center_enterprise_model_type").val();var str_regex=/^http:\/\//gi;var link=$(tpl).find("input[name=link]").eq(0).val();switch(type){case'1':if('-1'!=link.indexOf('设置链接地址')){$(tpl).find("input[name=link]").eq(0).val('');link=''}var file=$(tpl).find("#center_enterprise_upload_file").val();if(link&&null===link.match(str_regex)){alert('请设置有效链接地址！');$t.removeClass("btn_gray");return false}if(!file){alert('请选择上传文件！');$t.removeClass("btn_gray");return false}break;case'2':if(!link||null===link.match(str_regex)){alert('请设置有效视频地址！');$t.removeClass("btn_gray");return false}break;case'3':if('-1'!=link.indexOf('设置链接地址')){$(tpl).find("input[name=link]").eq(0).val('');link=''}var desc=$(tpl).find("textarea[name=desc]").eq(0).val();if(!desc){alert('请填写文案！');$t.removeClass("btn_gray");return false}if(link&&null===link.match(str_regex)){alert('请设置有效链接地址！');$t.removeClass("btn_gray");return false}break;default:alert('非法操作！');$t.removeClass("btn_gray");return false}$(this).addClass("btn_gray");$(tpl).find("#center_enterprise_form").submit()})}_bindEnterpirseDelete()})(jQuery);function _bindEnterpirseDelete(){$('.enterprise_container').unbind("hover").hover(function(){$(this).children('.delete').show()},function(){$(this).children('.delete').hide()});$('.enterprise_container .delete').unbind("click").click(function(){var $t=$(this),msg="确定删除此模块吗？";if('1'==$t.attr("_is_second_appear"))msg="删除该模块将会影响所有页面？";hd.dialog.confirm(false,msg,function(){hd.dialog.close();var $enterprise_container=$t.closest(".enterprise_container");var id=$enterprise_container.attr('id'),model_id=id.replace("enterprise_","");$("#enterprise_hidden_id").val(model_id);$("#center_enterprise_form_1").submit()})})}function _enterpriseAddCallback(data){var _type={'1':'1','2':'2','3':'3'},temp_a_left='',temp_a_right='';if('1'==data['status']){if(('1'==_type[data['data']['data']['type']]||'3'==_type[data['data']['data']['type']])&&data['data']['data']['link']){temp_a_left='<a href="{link}" target="_blank">';temp_a_right='</a>'}else if('3'==_type[data['data']['data']['type']]&&!data['data']['data']['link']){temp_a_left='<p>';temp_a_right='</p>'}}var img_model_tpl='<div class="vi_box enterprise_container" id="enterprise_{id}">'+temp_a_left+'<img src="{pic_src}" width="{pic_width}" alt="" />'+temp_a_right+'<a style="display: none;" class="delete" href="javascript://" title="删除" {_is_second_appear} >×</a>'+'</div>';var video_model_tpl='<div class="vi_box enterprise_container" id="enterprise_{id}">'+'<embed src="{link}" allowFullScreen="true" wmode="transparent" quality="high" width="210" height="210" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed>'+'<a class="delete" href="javascript://" title="删除" {_is_second_appear} >×</a>'+'</div>';var text_model_tpl='<div class="vi_box enterprise_container" id="enterprise_{id}">'+temp_a_left+'{desc}'+temp_a_right+'<a class="delete" href="javascript://" title="删除" {_is_second_appear} >×</a>'+'</div>';if('1'==data['status']){var data=data['data']['data'],temp_tpl=' ';if(_type[data['type']]){switch(_type[data['type']]){case'1':temp_tpl=img_model_tpl;break;case'2':temp_tpl=video_model_tpl;break;case'3':temp_tpl=text_model_tpl;break;default:break}temp_tpl=temp_tpl.replace(/\{\w+\}/g,function(m){return data[m.substring(1,m.length-1)]});$(".enterprise_container").last().after(temp_tpl);_bindEnterpirseDelete();$("#_center_enterprise_model .btn_green").removeClass("btn_gray");hd.dialog.close("_center_enterprise_model")}else{alert('非法操作');$("#_center_enterprise_model .btn_green").removeClass("btn_gray")}}else{alert(data['data']['msg']);$("#_center_enterprise_model .btn_green").removeClass("btn_gray")}}function _enterpriseDeleteCallback(data){if('1'==data['status']){var data=data['data']['data'];$("#enterprise_"+data['id']).remove()}else{hd.dialog.alert(data['data']['msg'])}}function _enterpriseBackgroundCallback(data){if('1'==data['status']){var data=data['data']['data'],temp='';if(!(data['type']&1))temp+=' no-repeat ';temp+=' center top ';if(data['type']&2)temp+=' fixed ';$("#center_header_back_ground_div").css("background","url("+data['background_src']+") "+temp)}else{alert(data['data']['msg'])}};(function(W,$,undefined){var hd=W.hd||{},q=location.search.substr(1).replace(/(&p=\d+|\bp=\d+&?)/,''),u=location.pathname.replace(/(\/p-\d+\/)/,'/')+(q.length?('?'+q):''),att='page-dg';hd.tools=hd.tools||{};hd.tools.page=function(opts){var $n=$(opts.nav),s=parseInt(opts.pages),c=parseInt(opts.current),ns=opts.size||3,b=opts.base,show=!!opts.show,v=[],d='<span class="more">...</span>',prev=c>1?c-1:c,next=c<s?c+1:c,left=c-ns,right=c+ns,x,j,i=0;if(isNaN(s)||s<1){s=1}if(isNaN(c)||c<1){c=1}else if(c>s){c=s}if(!b){b=u}if(left<1){left=1}if(right>s){right=s}var mk=(b.indexOf('?')>-1?'&':'?'),h=['<a href="'+b+mk+'p=','" p="','">','</a>'],mx=[[prev<c,'',prev,'上一页',''],[left>1,'',1,1,d],[right<s,d,s,s,''],[next>c,'',next,'下一页','']],sz=mx.length;for(;i<2;++i){if((x=mx[i])&&x[0]){v.push(x[1]+h[0]+x[2]+h[1]+x[2]+h[2]+x[3]+h[3]+x[4])}}for(j=left;j<c;++j){v.push(h[0]+j+h[1]+j+h[2]+j+h[3])}v.push('<span class="cur">'+c+'</span>');for(j=c+1;j<=right;++j){v.push(h[0]+j+h[1]+j+h[2]+j+h[3])}for(;i<sz;++i){if((x=mx[i])&&x[0]){v.push(x[1]+h[0]+x[2]+h[1]+x[2]+h[2]+x[3]+h[3]+x[4])}}for(i=0,sz=Math.min(2,v.length),mk=mk.replace('?','\\?')+'p=1\\b';i<sz;++i){v[i]=v[i].replace(new RegExp(mk),function(a,m){return''})}$n.html((v.length>1||show)?v.join(''):'');if(!$n.attr(att)){if(typeof opts.ajax=='function'){$n.off('.page','a').on({'click.page':function(e){opts.ajax.call(this,c,s);e.preventDefault();return false},'focus.page':function(e){$(this).blur()}},'a')}}if(typeof opts.callback=='function'){opts.callback.call($n,c,s)}else if(s>1){$n.slideDown(opts.speed||500)}return $n};W.hd=hd})(window,jQuery);(function(){var instances=[],$win=$(window),scroll_top=0;hd.tools.waterfall=function(el,options,obj){if(!options.url||!options.tpl)return;var instance={element:el,active:true,loading:true,pn:1,max_pn:5};options.max_pn=parseInt(options.max_pn);if(!isNaN(options.max_pn))instance=$.extend(instance,{max_pn:options.max_pn});if(options.pn)instance=$.extend(instance,{pn:options.pn});instance.options=$.extend({selector:'.img_container'},options);instance.children=$(el).find(instance.options.selector);instance.cols=instance.children.length;instance.height=init_height(instance);instance.load_number=0;instance.overflow=0;instance.obj=obj?obj:{};var index=instances.length;instances[index]=instance;load(instance);return{setActive:function(val){instances[index].active=!!val}}};function get_min_key(s,v){for(k in s){if(s[k]==v){return k}}};function init_height(instance){var arr=[];for(var i=0;i<instance.cols;i++){arr[i]=instance.children.eq(i).height()}return arr}function img_append(instance,$item){instance.load_number++;var min_key='';if(instance.load_number>instance.overflow){min_key=instance.load_number-instance.overflow-1}else{min_key=get_min_key(instance.height,Math.min.apply(null,instance.height))}var $cur=instance.children.eq(min_key);$cur.append($item);instance.height[min_key]=parseInt($cur.height())}function load(instance){if(instance.pn>instance.max_pn){if('function'==typeof instance.obj.callFinish){instance.obj.callFinish(instance)}return}if(instance.pn>=2){if($win.scrollTop()<200){instance.loading=false;return}}if('function'==typeof instance.obj.beforeSend){instance.obj.beforeSend(instance)}$.getJSON(instance.options.url,{pn:instance.pn},function(data){if('function'==typeof instance.obj.success){instance.obj.success(data)}var data_len=data['count'];var data=data['data'];if(data_len){instance.overflow+=data_len-data_len%instance.cols;for(i in data){var item=data[i];var $item=$(instance.options.tpl.replace(/\{\w+\}/g,function(m){return item[m.substring(1,m.length-1)]}));(function($item,instance){var $img=$item.find('img').eq(0);if($img.length>0){$item.find('img').eq(0).load(function(){img_append(instance,$item)}).error(function(){img_append(instance,$item)})}else{img_append(instance,$item)}})($item,instance)}}if('function'==typeof instance.obj.complete){instance.obj.complete(instance)}if(instance.pn>instance.max_pn){if('function'==typeof instance.obj.callFinish){instance.obj.callFinish(instance)}return}setTimeout(function(){releaseLoading(instance)},100)});instance.pn++};function releaseLoading(instance){instance.loading=false}$win.scroll(function(){var temp_scroll_top=$win.scrollTop();if(temp_scroll_top>scroll_top&&($win.height()+temp_scroll_top)>=$("body").height()-100){scroll_top=temp_scroll_top;$.each(instances,function(i,instance){if(!instance.active||instance.loading)return;instance.loading=true;load(instance)})}})})();(function($,win){var tpl='<div class="public_elastic_layer">'+'	<dl>'+'		<dt class="f14 b"><a class="ico20 close-it" href="javascript://" title="关闭">&nbsp;</a>加入专辑：</dt>'+'		<dd class="pdb20">'+'		<div class="image"><img class="recipe_cover" src="" width="194" height="194"></div>'+'		<div class="form">'+'			<div class="down-menu">'+'				<p class="all_inp"><input class="infant album_name" type="text" name="text_input" maxlength="32" readonly /></p>'+'				<i class="ico12 icoPic1"></i>'+'				<div class="down-list non">'+'					<div class="search-list">'+'						<ul></ul>'+'					</div>'+'					<div class="searchBar">'+'						<input class="txt-search" type="text" placeholder="创建一个专辑"><input type="submit" class="btn-search btn_green btn_create" value="创建">'+'					</div>'+'				</div>'+'			</div>'+'			<textarea class="textarea" placeholder="加入专辑时可以顺便说点什么~"></textarea>'+'			<p class="des-word">0/140</p>'+'			<div class="sync fr"></div>'+'		</div>'+'		</dd><dd class="atn tc"><a class="dbtn btn_green subbtn" href="javascript://" title="确定">确定</a> <a class="dbtn btn_gray close-it" href="javascript://" title="取消">取消</a></dd>'+'	</dl>'+'</div>',p_tpl='<div class="public_elastic_layer">'+'	<dl>'+'		<dt class="f14 b"><a class="ico20" href="javascript://" onclick="hd.dialog.close()" title="关闭">&nbsp;</a>加入专辑：</dt>'+'		<dd class="pdb20 s_msg-html">'+'		</dd>'+'		<dd class="atn tc">'+'			<a class="dbtn btn_green" href="javascript://" onclick="hd.dialog.close()" title="确定">确定</a>'+'		</dd>'+'	</dl>'+'</div>',s_tpl='<p class="f14 tc gray6" class>“{recipe}”已成功加入您指定的专辑</p>'+'<p class="f14 tc gray6">去 <a href="'+hd.base.root+'recipe/album/{id}/" target="_blank" class="green">{album}</a> 看看</p>',id='recipe_album_dialog',uid=hd.login.isLogin();function htmlEntities(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}function updateAlbumList(tpl,p,func){p=p||1;p=p>10?10:p;hd.cross.get(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=basic&p='+p,{},function(resp){try{if(typeof resp==='object'){var html='',elAlbumName=tpl.find('.album_name'),cur={};for(var i in resp){if(p=1){if(elAlbumName.data('cur')==undefined){elAlbumName.data('cur',resp[i]).val(resp[i].title);cur=resp[i]}else{cur=elAlbumName.data('cur');elAlbumName.val(cur.title)}first=false}if(resp[i].id==cur.id){html+='<li class="now" data-itemid="'+resp[i].id+'"><a href="javascript://" title="'+resp[i].title+'">'+resp[i].title+'</a></li>'}else{html+='<li data-itemid="'+resp[i].id+'"><a href="javascript://" title="'+resp[i].title+'">'+resp[i].title+'</a></li>'}};tpl.find('.search-list ul').append(html);if(typeof func=='function'){func()}}}catch(e){throw''}},'json')}function addSuccess(recipe,album,aid){recipe=htmlEntities(recipe);album=htmlEntities(album);hd.dialog.popup('addR_recipe_success',p_tpl,true,null,function(tpl){var _tmp=s_tpl.replace('{id}',aid).replace('{recipe}',recipe).replace('{album}',album);tpl.find('dd.s_msg-html').html(_tmp)})}hd.recipe_album=$.extend(hd.recipe_album||{},{p:1,loaded:false,rcpid:0,addTo:function(rcpid,cover_url){var root=this;root.rcpid=rcpid;if(uid<1){return hd.login.showLogin()}var p=this.p;hd.dialog.popup(id,tpl,true,function(tpl){tpl.find('.close-it').on('click',function(){hd.dialog.close();return false});var itemid=hd.tools.cookie('_r_last_add_album_id'),title=hd.tools.cookie('_r_last_add_album_title'),_uid=hd.tools.cookie('_r_last_add_album_uid');if(itemid!=undefined&&title!=undefined&&_uid==uid){tpl.find('.album_name').data('cur',{id:itemid,title:title}).val(title)}updateAlbumList(tpl,p,function(){root.loaded=true;$down_list.find('.search-list').on('scroll',function(e){var self=$(this),sh=self.get(0).scrollHeight,h=self.height(),st=self.scrollTop();if(p<10&&(st+h)>=$(this).get(0).scrollHeight){self.scrollTop(((st<1)?0:(st-1)));updateAlbumList(tpl,++p)}else if(p>=10){self.off('scroll')}})});var $down_list=tpl.find('.down-list');tpl.find('.album_name,.ico12').on('click',function(e){e.preventDefault();e.stopPropagation();$down_list.toggle()});tpl.find('.search-list').on('mouseover','li',function(){$(this).addClass('now').siblings().removeClass('now')});tpl.find('.search-list').on('click','li',function(){var data={id:$(this).data('itemid'),title:$(this).text()};$down_list.hide();tpl.find('.album_name').val(data.title).data('cur',data)});$(document).on('click',function(e){if(!$.contains($down_list.get(0),e.target)&&$down_list.is(':visible')){$down_list.hide()}});if(!hd.base.placeholder){var $placeholder=tpl.find('[placeholder]');$placeholder.each(function(){if($(this).val()==''){$(this).val($(this).attr('placeholder'))}})}var $des_word=tpl.find('.des-word');tpl.find('.textarea').bind('input propertychange',function(){var val=$(this).val(),len=val.length;if(!hd.base.placeholder&&val==$(this).attr('placeholder')){len=0}if(len>140){$des_word.css('color','red')}else{$des_word.css('color','#999999')}$des_word.text(len+'/140')});tpl.find('.txt-search').bind('input propertychange',function(){var v=$(this).val();if(v.length>20){$(this).val(v.substring(0,20))}});tpl.find('.btn_create').on('click',function(){var title=$.trim($(this).prev().val()),self=$(this);if(title==''){return false}hd.cross.post(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=create',{title:title},function(resp){var h_title=htmlEntities(title);if(resp!=null){if(resp.status==1){var elUl=tpl.find('.search-list ul');elUl.find('li.now').removeClass('now');elUl.append('<li class="now" data-itemid="'+resp.id+'"><a href="javascript://" title="'+h_title+'">'+h_title+'</a></li>');tpl.find('.album_name').val(title).data('cur',{id:resp.id,title:title});$down_list.hide();self.prev().val('')}else{alert(resp.msg)}}},'json')});tpl.find('.subbtn').on('click',function(){if(!root.loaded){return false}var uid=hd.login.isLogin(),album=tpl.find('.album_name').data('cur'),intro=tpl.find('.textarea').val();if(uid<1){return hd.login.showLogin()}if(album.id==undefined){alert('专辑id不正确');return}if(intro.length>140){alert('补充说明不能超出140个字');return false}else if(intro=='加入专辑时可以顺便说点什么~'){intro=''}hd.cross.post(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=addrecipe',{rcpid:root.rcpid,aid:album.id,intro:intro,share:hd.tools.sync.achieve(tpl)},function(resp){if(resp!=null){if(resp.status==1){hd.dialog.close();hd.tools.cookie('_r_last_add_album_id',resp.aid);hd.tools.cookie('_r_last_add_album_uid',uid);hd.tools.cookie('_r_last_add_album_title',resp.album);addSuccess(resp.recipe,resp.album,resp.aid);if(hd.base.placeholder){tpl.find('textarea.textarea').val('')}else{tpl.find('textarea.textarea').val('加入专辑时可以顺便说点什么~')}}else{alert(resp.msg)}}},'json')});if(!$.isFunction(hd.tools.sync)){$.ajax({url:hd.base.js+'tools/common.sync.js',dataType:'script',type:'GET',success:function(){hd.tools.sync.spread(tpl.find('.sync'))}})}else{hd.tools.sync.spread(tpl.find('.sync'))}},function(tpl){tpl.find('.recipe_cover').attr('src',cover_url)})}})})(jQuery,window);(function($){function getUid(){var uid=hd.login.isLogin();if(uid==false){hd.login.showLogin();return false}}var oRcp={init:function(){var el=$('.masonrySelector');el.on('mouseover','li',function(){$(this).find('.eHoverItem').show()}).on('mouseout','li',function(){var el=$(this).find('.eHoverItem');if(el.hasClass('neHoverItem'))return;el.hide()}).on('click','.eDelRcpPlan',function(){var uid=getUid();if(uid==false){return false}var item_id=$(this).data('itemid')-0;if(item_id<1){throw'No id';return false}var msg='确定要删除这个菜谱吗？';var elLi=$(this).parents('li:first');hd.dialog.confirm('操作确认',msg,function(){$.ajax({url:'?do=ajax&action=recipe&type=delete',type:'post',dataType:'json',data:'id='+item_id,cache:false,success:function(json){hd.dialog.close();if(json.status==1){hd.dialog.alert(json.info,'好豆网温馨提示',function(){elLi.remove();var elNav=$('.center_sidemenu a.sel');var s=elNav.text();elNav.text(s.replace(/\d+/i,/\d+/i.exec(s)-1));hd.dialog.close()})}else{hd.dialog.alert(json.info,'好豆网温馨提示',function(){hd.dialog.close()})}return false}});return false});return false}).on('click','.addToAlbumBtn',function(){var rid=$(this).data('itemid'),cover=$(this).data('cover');hd.recipe_album.addTo(rid,cover)}).on('click','.eLikeBtn',function(){var uid=getUid(),rcpid=parseInt($(this).data('itemid')),self=$(this);if(uid==false){return false}if(isNaN(rcpid)||rcpid<1){hd.dialog.alert('菜谱ID读取遇到错误~')}else{$.ajax({url:hd.base.root+'recipe/ajax.php?do=digg',data:{id:rcpid},type:'POST',dataType:'JSONP',success:function(resp){if(resp.status==true){self.removeClass('eLikeBtn');if(resp.code==1){var n=(self.text()-0)+1;self.html('<i class="ico20 icoPos3"> </i>'+n)}}else{hd.dialog.alert('亲~操作遇到错误了')}}})}});$("#evSearchBtn").on('click',function(){var key=$.trim($('#elSearchKey').val());if(!hd.base.placeholder&&(key=='搜索我发布的菜谱'||key=='搜索我喜欢的菜谱')){key=''}if(key!=''){var url='';var data=$('#elSearchKey').attr('data');if(data=='like'){url='?type='+data+'&key='+encodeURIComponent(key)}else{url='?key='+encodeURIComponent(key)}location.href=url}else{hd.dialog.alert('亲，请输入菜谱关键字~','好豆网温馨提示')}return false});$('#elSearchKey').keypress(function(e){if(e.keyCode==13){$("#evSearchBtn").click();return false}})}};oRcp.init()})(jQuery);(function($,undefined){var cache={},rmap={'ip':'在你附近','fav':'相同口味','city':'和你在同一城市','recipe':'菜谱达人','share':'美食达人','vip':'认证用户'};function _ajax_follow(uid,type,$a,$li){var $lis=$li.siblings(),l=$lis.length,nt=[];for(var i=0;i<l;++i){nt.push($lis.eq(i).attr('uid'))}var get_data={'who':uid,'type':type,'not':nt};if(type=='guess'){get_data.guess=$a.data('guess')}$.ajax({url:'http://wo.haodou.com/user/follow.php?do=follow',data:get_data,dataType:'jsonp',success:function(resp){delete cache[uid];hd.wealthTip();if(typeof resp.user!='undefined'){var u=resp.user,i=u.UserId,n=u.UserName,t=typeof u.PopType=='undefined'?u.GuessType:u.PopType;$li.replaceWith('<li uid="'+i+'"><a href="http://wo.haodou.com/'+i+'/" title="" target="_blank" class="img"><img src="'+u.AvatarUrl+'" alt="" width="48" height="48" /></a><p><a href="http://wo.haodou.com/'+i+'/" title="'+n+'" target="_blank" class="mgr10">'+n+'</a><a class="sbtn btn_gray mgl10" href="javascript:///" data-guess="'+t+'" title="加关注"><b class="orange">+</b>关注</a></p><p class="f12 gray9">'+(rmap[t]?rmap[t]:'')+'</p></li>')}else{$a.replaceWith('<span title="已关注" class="sbtn mgl10">已关注</span>')}}})}function _ajax_shuffle(type,hp){$.ajax({url:'http://wo.haodou.com/user/follow.php',data:{'do':'ajax','type':type,'act':'shuffle'},dataType:'jsonp',success:function(resp){if(resp.ret===0){var html=[];$.each(resp.data,function(i,row){var i=row.UserId,n=row.UserName,why=row.Why;html.push('<li uid="'+i+'"><a href="'+hp(i)+'" title="" target="_blank" class="img"><img src="'+row.AvatarUrl+'" width="48" height="48" alt="" /></a><p><a href="'+hp(i)+'" title="'+n+'" class="mgr10" target="_blank">'+n+'</a><a class="sbtn btn_gray mgl10" href="javascript:///" data-guess="'+row.GuestType+'" title="加关注"><b class="orange">+</b>关注</a></p><p class="f12 gray9">'+why+'</p></li>')});$('#'+type+'-box').find('ul').html(html.join(''))}}})}$('#popular-box,#guess-box').each(function(){var type=$(this).attr('id').split('-')[0];$(this).on('click','a.btn_gray',function(){var $a=$(this),$li=$a.closest('li'),uid=$li.attr('uid');if(/\d+/.test(uid)){if(typeof cache[uid]=='undefined'){cache[uid]=uid;_ajax_follow(uid,type,$a,$li)}return false}});var center=this.getAttribute('center');$(this).on('click','h2 a',function(){_ajax_shuffle(type,function(uid){if(center=='1'){return"http://wo.haodou.com/"+uid+'/'}else if(center=='2'){return"http://www.haodou.com/pai/user/"+uid}else{return"http://wo.haodou.com/"+uid+"/"}});return false})});$('.center_userList a.btn_gray').bind('click',function(){hd.follow($(this).data('uid'),'<span title="已关注" class="sbtn fr">已关注</span>');return false})})(jQuery);