/*!2017-10-29 00:49:56 merge: js/recipe/category.js,js/recipe/album/add_recipe.js,js/recipe/all.js!*/
;(function($){var category_tpl='<li><a class="ht" href="LINK" target="_blank" title="TITLE">TITLE<em class="ico12">&nbsp;</em></a></li>';var category_more='<li><a class="last" href="/recipe/category" target="_blank" title="更多分类标签">更多分类标签</a></li>';var recipe={category_auto:function(){var show=$('#category_nav:visible').size();if(show<=0){recipe.category_one()}else{recipe.category_two()}},category_one:function(){$('#category').hover(function(){$('#category_a').show()},function(){$('#category_a').hide()});var one_flag=true;$('#category').mouseover(function(){if(one_flag==true){one_flag=false;$('#category_nav').html('<li><a class="ht" href="javascript:;">菜谱分类加载中...</li>');$.ajax({url:hd.base.root+'recipe/ajax?do=categorylist',dataType:'json',success:function(json){if(json.status){var data=json.info;var html="",list=data;$.each(list,function(i,n){var k=i+1;var tmp=category_tpl;tmp=tmp.replace(/LINK/g,"/recipe/all?ct="+i);tmp=tmp.replace(/TITLE/g,n);html+=tmp});html+=category_more;$('#category_nav').html(html)}else{one_flag=true}}})}})},category_two:function(){var li_now=$('#category_nav li a').index($('#category_nav li a.sel'));$('#category_nav li:not(#category_nav li:last())').click(function(){var li_temp_now=$(this).index();if($('#category_box_'+li_temp_now).size()>0){$('#category_box_'+li_temp_now).show();$('.classified_box:not(#category_box_'+li_temp_now+')').hide();li_now=li_temp_now;$(this).children('a').addClass('sel');$(this).siblings().children('a').removeClass('sel')}})},favorite:function(){var survery=$('<div class="addfavs" style="display:block;"><a href="javascript://" title="加入到收藏夹"></a></div>');var css={'position':'fixed','top':200,'right':'0px'};if($.browser.version=='6.0'){css.position='absolute';$(window).scroll(function(){survery.css({'top':$(document).scrollTop()+$(window).height()/2})})}survery.css(css);$("body").append(survery);$('.addfavs a').click(function(){var ctrl=(navigator.userAgent.toLowerCase()).indexOf('mac')!=-1?'Command/Cmd':'CTRL';var title=document.title;var url=document.location.href;url=(url.indexOf('?')==-1)?url+"?from=favorite":url+'&from=favorite';try{window.external.addFavorite(url,title)}catch(e){try{window.sidebar.addPanel(title,url,"")}catch(e){hd.dialog.alert('加入到收藏夹失败！您可以尝试通过快捷键'+ctrl+' + D 加入到收藏夹~')}}})},navfixed:function(){$('.status_space').hide();$('.new_status').addClass('lock');var flex="",nav_top=0,nav_class="fixed";var show=$('#category_nav:visible').size();var flex=$('.def_header');if(show==0){nav_top=113}else{nav_top=395}if(flex){$(window).bind('scroll.fixed',function(){if(!flex.data('fixed')&&$(document).scrollTop()>=nav_top){flex.addClass(nav_class).data('fixed',1);if(nav_top==395){recipe.change_cate_down(flex)}}else if($(document).scrollTop()<nav_top){flex.removeClass(nav_class).data('fixed',0);if(nav_top==395){recipe.change_cate_up(flex)}}});$(window).trigger("scroll")}},'change_cate_down':function(flex){flex.find('p.tt,p.xt').html('菜谱分类导航<i class="ico20 iarr">&nbsp;</i>');flex.find('#category_a').hide();flex.find('#category').hover(function(){flex.find('#category_a').show()},function(){flex.find('#category_a').hide()});var t=flex.find('#category_nav li').size();flex.find('#category_nav li').each(function(i,n){var k=parseInt(i+1);if(k<t){$(this).children('a').attr("href","/recipe/all?ct="+k)}})},'change_cate_up':function(flex){flex.find('p.tt,p.xt').html('菜谱分类导航');flex.find('#category_a').show();flex.find('#category').unbind("hover")}};$(function(){if(!hd.base.ie6){recipe.navfixed()}recipe.category_auto();recipe.favorite()})})(jQuery);(function($,win){var tpl='<div class="public_elastic_layer">'+'	<dl>'+'		<dt class="f14 b"><a class="ico20 close-it" href="javascript://" title="关闭">&nbsp;</a>加入专辑：</dt>'+'		<dd class="pdb20">'+'		<div class="image"><img class="recipe_cover" src="" width="194" height="194"></div>'+'		<div class="form">'+'			<div class="down-menu">'+'				<p class="all_inp"><input class="infant album_name" type="text" name="text_input" maxlength="32" readonly /></p>'+'				<i class="ico12 icoPic1"></i>'+'				<div class="down-list non">'+'					<div class="search-list">'+'						<ul></ul>'+'					</div>'+'					<div class="searchBar">'+'						<input class="txt-search" type="text" placeholder="创建一个专辑"><input type="submit" class="btn-search btn_green btn_create" value="创建">'+'					</div>'+'				</div>'+'			</div>'+'			<textarea class="textarea" placeholder="加入专辑时可以顺便说点什么~"></textarea>'+'			<p class="des-word">0/140</p>'+'			<div class="sync fr"></div>'+'		</div>'+'		</dd><dd class="atn tc"><a class="dbtn btn_green subbtn" href="javascript://" title="确定">确定</a> <a class="dbtn btn_gray close-it" href="javascript://" title="取消">取消</a></dd>'+'	</dl>'+'</div>',p_tpl='<div class="public_elastic_layer">'+'	<dl>'+'		<dt class="f14 b"><a class="ico20" href="javascript://" onclick="hd.dialog.close()" title="关闭">&nbsp;</a>加入专辑：</dt>'+'		<dd class="pdb20 s_msg-html">'+'		</dd>'+'		<dd class="atn tc">'+'			<a class="dbtn btn_green" href="javascript://" onclick="hd.dialog.close()" title="确定">确定</a>'+'		</dd>'+'	</dl>'+'</div>',s_tpl='<p class="f14 tc gray6" class>“{recipe}”已成功加入您指定的专辑</p>'+'<p class="f14 tc gray6">去 <a href="'+hd.base.root+'recipe/album/{id}/" target="_blank" class="green">{album}</a> 看看</p>',id='recipe_album_dialog',uid=hd.login.isLogin();function htmlEntities(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}function updateAlbumList(tpl,p,func){p=p||1;p=p>10?10:p;hd.cross.get(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=basic&p='+p,{},function(resp){try{if(typeof resp==='object'){var html='',elAlbumName=tpl.find('.album_name'),cur={};for(var i in resp){if(p=1){if(elAlbumName.data('cur')==undefined){elAlbumName.data('cur',resp[i]).val(resp[i].title);cur=resp[i]}else{cur=elAlbumName.data('cur');elAlbumName.val(cur.title)}first=false}if(resp[i].id==cur.id){html+='<li class="now" data-itemid="'+resp[i].id+'"><a href="javascript://" title="'+resp[i].title+'">'+resp[i].title+'</a></li>'}else{html+='<li data-itemid="'+resp[i].id+'"><a href="javascript://" title="'+resp[i].title+'">'+resp[i].title+'</a></li>'}};tpl.find('.search-list ul').append(html);if(typeof func=='function'){func()}}}catch(e){throw''}},'json')}function addSuccess(recipe,album,aid){recipe=htmlEntities(recipe);album=htmlEntities(album);hd.dialog.popup('addR_recipe_success',p_tpl,true,null,function(tpl){var _tmp=s_tpl.replace('{id}',aid).replace('{recipe}',recipe).replace('{album}',album);tpl.find('dd.s_msg-html').html(_tmp)})}hd.recipe_album=$.extend(hd.recipe_album||{},{p:1,loaded:false,rcpid:0,addTo:function(rcpid,cover_url){var root=this;root.rcpid=rcpid;if(uid<1){return hd.login.showLogin()}var p=this.p;hd.dialog.popup(id,tpl,true,function(tpl){tpl.find('.close-it').on('click',function(){hd.dialog.close();return false});var itemid=hd.tools.cookie('_r_last_add_album_id'),title=hd.tools.cookie('_r_last_add_album_title'),_uid=hd.tools.cookie('_r_last_add_album_uid');if(itemid!=undefined&&title!=undefined&&_uid==uid){tpl.find('.album_name').data('cur',{id:itemid,title:title}).val(title)}updateAlbumList(tpl,p,function(){root.loaded=true;$down_list.find('.search-list').on('scroll',function(e){var self=$(this),sh=self.get(0).scrollHeight,h=self.height(),st=self.scrollTop();if(p<10&&(st+h)>=$(this).get(0).scrollHeight){self.scrollTop(((st<1)?0:(st-1)));updateAlbumList(tpl,++p)}else if(p>=10){self.off('scroll')}})});var $down_list=tpl.find('.down-list');tpl.find('.album_name,.ico12').on('click',function(e){e.preventDefault();e.stopPropagation();$down_list.toggle()});tpl.find('.search-list').on('mouseover','li',function(){$(this).addClass('now').siblings().removeClass('now')});tpl.find('.search-list').on('click','li',function(){var data={id:$(this).data('itemid'),title:$(this).text()};$down_list.hide();tpl.find('.album_name').val(data.title).data('cur',data)});$(document).on('click',function(e){if(!$.contains($down_list.get(0),e.target)&&$down_list.is(':visible')){$down_list.hide()}});if(!hd.base.placeholder){var $placeholder=tpl.find('[placeholder]');$placeholder.each(function(){if($(this).val()==''){$(this).val($(this).attr('placeholder'))}})}var $des_word=tpl.find('.des-word');tpl.find('.textarea').bind('input propertychange',function(){var val=$(this).val(),len=val.length;if(!hd.base.placeholder&&val==$(this).attr('placeholder')){len=0}if(len>140){$des_word.css('color','red')}else{$des_word.css('color','#999999')}$des_word.text(len+'/140')});tpl.find('.txt-search').bind('input propertychange',function(){var v=$(this).val();if(v.length>20){$(this).val(v.substring(0,20))}});tpl.find('.btn_create').on('click',function(){var title=$.trim($(this).prev().val()),self=$(this);if(title==''){return false}hd.cross.post(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=create',{title:title},function(resp){var h_title=htmlEntities(title);if(resp!=null){if(resp.status==1){var elUl=tpl.find('.search-list ul');elUl.find('li.now').removeClass('now');elUl.append('<li class="now" data-itemid="'+resp.id+'"><a href="javascript://" title="'+h_title+'">'+h_title+'</a></li>');tpl.find('.album_name').val(title).data('cur',{id:resp.id,title:title});$down_list.hide();self.prev().val('')}else{alert(resp.msg)}}},'json')});tpl.find('.subbtn').on('click',function(){if(!root.loaded){return false}var uid=hd.login.isLogin(),album=tpl.find('.album_name').data('cur'),intro=tpl.find('.textarea').val();if(uid<1){return hd.login.showLogin()}if(album.id==undefined){alert('专辑id不正确');return}if(intro.length>140){alert('补充说明不能超出140个字');return false}else if(intro=='加入专辑时可以顺便说点什么~'){intro=''}hd.cross.post(hd.base.center+uid+'/recipe/?do=ajax&action=album&type=addrecipe',{rcpid:root.rcpid,aid:album.id,intro:intro,share:hd.tools.sync.achieve(tpl)},function(resp){if(resp!=null){if(resp.status==1){hd.dialog.close();hd.tools.cookie('_r_last_add_album_id',resp.aid);hd.tools.cookie('_r_last_add_album_uid',uid);hd.tools.cookie('_r_last_add_album_title',resp.album);addSuccess(resp.recipe,resp.album,resp.aid);if(hd.base.placeholder){tpl.find('textarea.textarea').val('')}else{tpl.find('textarea.textarea').val('加入专辑时可以顺便说点什么~')}}else{alert(resp.msg)}}},'json')});if(!$.isFunction(hd.tools.sync)){$.ajax({url:hd.base.js+'tools/common.sync.js',dataType:'script',type:'GET',success:function(){hd.tools.sync.spread(tpl.find('.sync'))}})}else{hd.tools.sync.spread(tpl.find('.sync'))}},function(tpl){tpl.find('.recipe_cover').attr('src',cover_url)})}})})(jQuery,window);(function($){var page_cache={},selt_tag=[],tids="",order="time",recipetotal=$('#recipetotal').val(),big_page=$('#big_page').val(),small_page=1,min_page=1,max_page=3,limit_page=19,loadmore=true,loadpage=true,page_type=1,page_flag=true,ul_height=[],ul_obj=$('.recipe_all_list ul'),ul_size=ul_obj.size(),like_cache={};var one_size=9;var cur_order=$('#recipeorder a.sel').attr('id');if(cur_order){order=cur_order.substr(2)}var allrecipe={get_min_key:function(s,v){for(k in s){if(s[k]==v){return k}}},init_height:function(){for(var i=0;i<ul_size;i++){ul_height[i]=ul_obj.eq(i).height()}},tag_inarray:function(search_tag,tag_array){var search_flag=false;$.each(tag_array,function(i,n){if(search_tag==n){search_flag=true}});return search_flag},tag_selt:function(){selt_tag=$('#selt_tag').find('a').map(function(){return $(this).attr('id')});tids="";var tmp_tids=[];if(selt_tag.length>0){$.each(selt_tag,function(i,n){n=n.slice(9);tmp_tids[i]=n});tmp_tids.sort();$.each(tmp_tids,function(i,n){tids+='_'+n});tids=tids.slice(1)}$('.classified_box').find('a.act').each(function(){var act_id=$(this).attr('id');act_id='selt_'+act_id;if($.inArray(act_id,selt_tag)==-1){$(this).removeClass('act')}})},tag_click:function(){$('.classified_box').on('click','a',function(){page_type=2;var tid=$(this).attr('id');var tid_text=$(this).text();var all_tag=$(this).parents('div.classified_box').find('a').map(function(){return $(this).attr('id')});var html=new_tids='';if(selt_tag.length>0){var k=0;$.each(selt_tag,function(i,n){n=n.slice(5);if(n!=tid&&!allrecipe.tag_inarray(n,all_tag)&&k<3){k++}else{$('#selt_'+n).parent().remove()}})}$(this).addClass('act');html='<div class="ph1"><h1>'+tid_text+'</h1><a href="javascript://" id="selt_'+tid+'">&times;</a></div>';$('#selt_tag').append(html);allrecipe.tag_selt();big_page=1;small_page=0;loadmore=true;allrecipe.get_recipe();return false})},tag_del:function(){$('#selt_tag').on('click','a',function(){page_type=2;$(this).parent().remove();allrecipe.tag_selt();big_page=1;small_page=0;loadmore=true;allrecipe.get_recipe()})},order_click:function(){$('#recipeorder a').click(function(){var order_id=$(this).attr('id');var orderby=order_id.slice(2);if(orderby!=order){order=orderby;$(this).addClass('sel').siblings().removeClass('sel');big_page=1;small_page=0;loadmore=loadpage=true;page_type=2;allrecipe.get_recipe()}})},get_recipe:function(){if(loadmore==true){loadmore=false;small_page=parseInt(small_page)+1;if(small_page<min_page){small_page=min_page}if(small_page>max_page){small_page=max_page}var cache_key="recipe-"+tids+"-"+order+"-"+big_page+"-"+small_page;$('.bd_pagex').hide().html('');$('#recipe_loading').show();if(page_cache[cache_key]){allrecipe.load_recipe(page_cache[cache_key])}else{$.ajax({type:"GET",url:hd.base.root+'recipe/all?do=getrecipe',data:({tid:tids,order:order,bigpage:big_page,smallpage:small_page}),dataType:'json',success:function(json){if(json.status==true){page_cache[cache_key]=json;allrecipe.load_recipe(json)}else{$('#recipe_loading').hide()}}})}}return false},load_recipe:function(json){var data_total=0;$.each(json.info,function(k){data_total=parseInt(k)+1});$('#no_recipe_data,#recipe_loading').hide();if(small_page==1){ul_obj.each(function(ul_i){$(this).children('li:not(.fixed_li)').remove();$(this).append('<li class="none" id="placeholder_'+ul_i+'">&nbsp;</li>')});var overflow=data_total-(data_total-one_size)%ul_size}else{var loadtotal=19*(small_page-1);var overtotal=4-((loadtotal-one_size)%ul_size);var overflow=data_total-(data_total-overtotal)%ul_size}if(data_total==0){$('#no_recipe_data').show();ul_obj.each(function(ul_i){if(ul_i<3){$(this).hide()}})}else{allrecipe.init_height();ul_obj.show();recipetotal=json.total;var li_tpl='<li><div class="picList"><p class="bigimg"><a title="{title}" target="_blank" href="/recipe/{id}"><img height="194" width="194" alt="{title}" src="{cover}">{isvideo}</a><a class="join btn_green dbtn" data="{id}" style="display: none;" title="收藏到专辑" href="javascript://"><i class="ico12">&nbsp;</i>收藏到专辑</a></p><p class="f14 mgt5"><a title="{title}" target="_blank" href="/recipe/{id}">{title}</a></p><p class="box"> <a class="fl btn_orange dbtn dbtn_n like_click" id="l_{id}" href="javascript://">{lflag}点赞</a> <span class="fl dbcl dbcl_orange"><i class="ico12 allIco3">&nbsp;</i><span class="num">{lcount}</span></span> <span class="fr mgt5 gray6"><a class="imit_a" target="_blank" title="评论" href="/recipe/{id}#comment">评论</a><em class="gray9">({ccount})</em></span> </p></div><div class="txtBox gray6"><p class="fr gray9">{ctime}</p><p><a class="gray6" title="{name}" target="_blank" href="http://wo.haodou.com/{uid}/" rel="nofollow"><img height="22" width="22" alt="{name}" src="{avatar}">{subname}</a></p></div></li>';$.each(json.info,function(i,n){var $item=$(li_tpl.replace(/\{\w+\}/g,function(m){var a=m.substring(1,m.length-1);if(a=='lflag'){if(n[a]||like_cache[n.id]){return'取消'}else{return'<i class="ico20 allIco1">&nbsp;</i>'}}else if(a=='lcount'){if(like_cache[n.id]){return like_cache[n.id]}}else if(a=='isvideo'){if(n[a]){return'<em class="imit_b">&nbsp;</em>'}else{return""}}return n[a]}));allrecipe.append_recipe(i,$item,overflow)});if(small_page<max_page){loadmore=true}else{loadpage=true}}},append_recipe:function(index,li_tpl,overflow){var min_key=index>=overflow?(index-overflow):allrecipe.get_min_key(ul_height,Math.min.apply(null,ul_height));$('#placeholder_'+min_key).remove();ul_obj.eq(min_key).append(li_tpl);ul_height[min_key]=parseInt(ul_height[min_key])+parseInt(li_tpl.height())},get_page:function(){if(loadpage==true){loadpage=false;if(recipetotal>limit_page*max_page){$('.bd_pagex').html('').hide();var page_cache_key="page-"+recipetotal+'-'+big_page+'-'+page_type;if(page_cache[page_cache_key]){$('.bd_pagex').html(page_cache[page_cache_key]).show()}else{$.ajax({type:"GET",url:hd.base.root+'recipe/all?do=getpage',data:({type:page_type,total:recipetotal,page:big_page}),dataType:'json',success:function(data){if(data.status){$('.bd_pagex').html(data.info).show();page_cache[page_cache_key]=data.info}}})}}}if(page_type==2&&page_flag==true){page_flag=false;$('.bd_pagex').on('click','a',function(){var click_page=$(this).attr('page');if(click_page!=big_page){$("html,body").animate({scrollTop:410},200);big_page=click_page;small_page=0;loadmore=loadpage=true;allrecipe.get_recipe()}})}},autoload_recipe:function(){$(window).bind("scroll",function(){var morerecipe_top=$('#morerecipe').offset().top;if(($(window).height()+$(window).scrollTop())>=morerecipe_top){var loadtotal=limit_page*((big_page-1)*max_page+small_page);if((loadtotal>=recipetotal&&recipetotal>0)||small_page==max_page){if($('.bd_pagex').html()==''&&loadpage==true){allrecipe.get_page()}}else if(loadmore==true&&loadtotal<recipetotal){allrecipe.get_recipe()}}})},like_recipe:function(){var like_flag=true;var show_html_unlike='取消点赞';var show_html_like='点赞';ul_obj.on('click','a.like_click',function(){if(!hd.login.isLogin()){hd.login.showLogin();return false}else{if(like_flag==true){like_flag=false;var like_id=$(this).attr('id');var like_html=$.trim($(this).text());var rid=like_id.slice(2);if(rid){var url='';var show_html='';var total_obj=$('#l_'+rid+' + span').find('span.num');var show_obj=$('#l_'+rid);var like_total=total_obj.html();if(like_html==show_html_unlike){url=hd.base.root+'recipe/ajax.php?do=undigg';show_html="<i class='ico20 allIco1'>&nbsp;</i>"+show_html_like;like_total=parseInt(like_total)-1}if(like_html==show_html_like){url=hd.base.root+'recipe/ajax.php?do=digg';show_html=show_html_unlike;like_total=parseInt(like_total)+1}$.ajax({type:"POST",url:url,data:{id:rid},dataType:'json',success:function(json){if(json.status==true&&json.code==1){total_obj.html(like_total);$('.like_click').each(function(i,n){if($(this).attr('id')==like_id){$(this).unbind('click');$(this).html(show_html)}})}else{hd.dialog.alert(json.info)}like_flag=true},error:function(){like_flag=true}})}else{like_flag=true}}}})},addtoalbum:function(){ul_obj.on('mouseover','li',function(){$(this).find('a.join').show()});ul_obj.on('mouseout','li',function(){$(this).find('a.join').hide()});ul_obj.on('click','a.join',function(){var id=$(this).attr('data');var cover=$(this).parent().find('img').attr('src');if(id>0&&cover&&cover!='undefined'){hd.recipe_album.addTo(id,cover)}})},openintro:function(){var fiopen=$(".fiopen");var ficlose=$(".ficlose");ficlose.hide();fiopen.on('click','',function(){$(this).parent().find('span').text($(this).attr('alt'));fiopen.hide();ficlose.show()});ficlose.on('click','',function(){$(this).parent().find('span').text($(this).attr('alt'));fiopen.show();ficlose.hide()})}};$(function(){one_size=$('.recipe_all_list').attr('data');allrecipe.order_click();allrecipe.tag_click();allrecipe.tag_selt();allrecipe.tag_del();allrecipe.autoload_recipe();allrecipe.init_height();allrecipe.like_recipe();allrecipe.addtoalbum();allrecipe.openintro();$('.expert_user').click(function(){var uid=parseInt($(this).attr('id'));if(uid){hd.follow(uid)}})})})(jQuery);