/*!2017-10-30 16:40:24 merge: js/recipe/category.js,js/center/checkemail.js,js/recipe/album/create.js!*/
;(function($){var category_tpl='<li><a class="ht" href="LINK" target="_blank" title="TITLE">TITLE<em class="ico12">&nbsp;</em></a></li>';var category_more='<li><a class="last" href="/recipe/category" target="_blank" title="更多分类标签">更多分类标签</a></li>';var recipe={category_auto:function(){var show=$('#category_nav:visible').size();if(show<=0){recipe.category_one()}else{recipe.category_two()}},category_one:function(){$('#category').hover(function(){$('#category_a').show()},function(){$('#category_a').hide()});var one_flag=true;$('#category').mouseover(function(){if(one_flag==true){one_flag=false;$('#category_nav').html('<li><a class="ht" href="javascript:;">菜谱分类加载中...</li>');$.ajax({url:hd.base.root+'recipe/ajax?do=categorylist',dataType:'json',success:function(json){if(json.status){var data=json.info;var html="",list=data;$.each(list,function(i,n){var k=i+1;var tmp=category_tpl;tmp=tmp.replace(/LINK/g,"/recipe/all?ct="+i);tmp=tmp.replace(/TITLE/g,n);html+=tmp});html+=category_more;$('#category_nav').html(html)}else{one_flag=true}}})}})},category_two:function(){var li_now=$('#category_nav li a').index($('#category_nav li a.sel'));$('#category_nav li:not(#category_nav li:last())').click(function(){var li_temp_now=$(this).index();if($('#category_box_'+li_temp_now).size()>0){$('#category_box_'+li_temp_now).show();$('.classified_box:not(#category_box_'+li_temp_now+')').hide();li_now=li_temp_now;$(this).children('a').addClass('sel');$(this).siblings().children('a').removeClass('sel')}})},favorite:function(){var survery=$('<div class="addfavs" style="display:block;"><a href="javascript://" title="加入到收藏夹"></a></div>');var css={'position':'fixed','top':200,'right':'0px'};if($.browser.version=='6.0'){css.position='absolute';$(window).scroll(function(){survery.css({'top':$(document).scrollTop()+$(window).height()/2})})}survery.css(css);$("body").append(survery);$('.addfavs a').click(function(){var ctrl=(navigator.userAgent.toLowerCase()).indexOf('mac')!=-1?'Command/Cmd':'CTRL';var title=document.title;var url=document.location.href;url=(url.indexOf('?')==-1)?url+"?from=favorite":url+'&from=favorite';try{window.external.addFavorite(url,title)}catch(e){try{window.sidebar.addPanel(title,url,"")}catch(e){hd.dialog.alert('加入到收藏夹失败！您可以尝试通过快捷键'+ctrl+' + D 加入到收藏夹~')}}})},navfixed:function(){$('.status_space').hide();$('.new_status').addClass('lock');var flex="",nav_top=0,nav_class="fixed";var show=$('#category_nav:visible').size();var flex=$('.def_header');if(show==0){nav_top=113}else{nav_top=395}if(flex){$(window).bind('scroll.fixed',function(){if(!flex.data('fixed')&&$(document).scrollTop()>=nav_top){flex.addClass(nav_class).data('fixed',1);if(nav_top==395){recipe.change_cate_down(flex)}}else if($(document).scrollTop()<nav_top){flex.removeClass(nav_class).data('fixed',0);if(nav_top==395){recipe.change_cate_up(flex)}}});$(window).trigger("scroll")}},'change_cate_down':function(flex){flex.find('p.tt,p.xt').html('菜谱分类导航<i class="ico20 iarr">&nbsp;</i>');flex.find('#category_a').hide();flex.find('#category').hover(function(){flex.find('#category_a').show()},function(){flex.find('#category_a').hide()});var t=flex.find('#category_nav li').size();flex.find('#category_nav li').each(function(i,n){var k=parseInt(i+1);if(k<t){$(this).children('a').attr("href","/recipe/all?ct="+k)}})},'change_cate_up':function(flex){flex.find('p.tt,p.xt').html('菜谱分类导航');flex.find('#category_a').show();flex.find('#category').unbind("hover")}};$(function(){if(!hd.base.ie6){recipe.navfixed()}recipe.category_auto();recipe.favorite()})})(jQuery);function _commonCheckEmailInit(){var iframe_tpl='<form id="common_check_email_hidden_form_1" action="http://wo.haodou.com/checkemail.php" method="post" target="common_check_email_hidden_frame" ></form>'+'<iframe id="common_check_email_hidden_frame" name="common_check_email_hidden_frame" src="about:blank" style="display:none"></iframe>';if(!$('#common_check_email_hidden_frame').length){$('body').append(iframe_tpl)}$("#common_check_email_hidden_form_1").submit()}function _commonCheckEmailCallback(json){var tpl_params={'pai':{'set_title':'你需要验证邮箱后才能创建专辑','send_title':'你需要验证邮箱后才能创建专辑'},'space':{'set_title':'你需要验证邮箱后才能发布话题','send_title':'你需要验证邮箱后才能发布话题'},'recipe':{'set_title':'你需要验证邮箱后才能发布菜谱','send_title':'你需要验证邮箱后才能发布菜谱'}};if(json.status=='1'){if(json.data.tpl_model=='set')setEmail(tpl_params,json);else if(json.data.tpl_model=='send')sendEmail(tpl_params,json,true)}else if(json.status==2){hd.dialog.close('_common_check_email_set_model');sendEmail(tpl_params,json,false);if(typeof json.data.msg!='undefined'&&typeof json.data.is_again!='undefined'&&json.data.is_again=='1')alert(json.data.msg)}else if(json.status=='0'){alert(json.data.msg);$("#_common_check_email_set_model .btn_green").removeClass('lock')}$("#_common_check_email_send_model #check_email_send_agin").removeClass('lock');return false;function setEmail(tpl_params,json){var tpl='<form id="common_check_email_hidden_form_2" action="http://wo.haodou.com/checkemail.php?do=setEmail" method="post" target="common_check_email_hidden_frame" >'+'<div class="public_elastic_layer">'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript:///" class="ico20 check_email_close">&nbsp;</a>'+tpl_params[json.data.tpl_params]['set_title']+'</dt>'+'<dd>'+'<div class="pop_fm_box">'+'<input type="text" placeholder="请输入你的邮箱地址" maxlength="32" name="email" class="long_inp">'+'</div>'+'</dd>'+'<dd class="atn tc"><a title="确认提交" href="javascript:///" class="dbtn btn_green">确认提交</a></dd>'+'</dl>'+'</div>'+'<input type="hidden" name="cur_page_model" value="'+json['data']['tpl_params']+'" />'+'</form>';hd.dialog.popup('_common_check_email_set_model',tpl,true,function(tpl){$(tpl).find(".check_email_close").click(function(){hd.dialog.close('_common_check_email_set_model')})},function(tpl){var $dbtn=$(tpl).find(".dbtn");$dbtn.click(function(){if($dbtn.hasClass('lock'))return false;$dbtn.addClass("lock");var email=$.trim($(tpl).find('input[name="email"]').val());if(!email||!/^[a-z0-9][\w-.]{0,31}@([a-z0-9][a-z0-9-]{0,30}[a-z0-9]\.){1,4}[a-z]{2,4}$/i.test(email)){alert('邮箱地址格式不正确！');$dbtn.removeClass('lock');return false}$(tpl).find("#common_check_email_hidden_form_2").submit()})})}function sendEmail(tpl_params,json,is_send){var tpl='<form id="common_check_email_hidden_form_3" action="http://wo.haodou.com/checkemail.php?do=sendEmail" method="post" target="common_check_email_hidden_frame" >'+'<div class="public_elastic_layer">'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript:///" class="ico20 check_email_close">&nbsp;</a>'+tpl_params[json.data.tpl_params]['send_title']+'</dt>'+'<dd>'+'<div class="goeat_special_create_mail2">'+'好豆网向'+json['data']['email']+'发送了一封确认邮件<br>'+'点击邮件中的确认链接，即可完成帐号的激活，快去检查邮件吧~<br><br>'+'<a class="btnMain btn_green" title="查看邮件" target="_blank" href="http://mail.'+json['data']['email'].split('@')[1]+'"><i class="ico20 icoMail">&nbsp;</i>查看邮件</a><br><br>'+'<i class="ico20 icoplaint"></i>没有收到确认邮件？<br>-到垃圾邮件、广告邮件中找找看<br>-点击这里<a class="gray6" title="重新发送邮件" id="check_email_send_agin" href="javascript:///">重新发送邮件</a><br>'+'-点击这里<a class="gray6" title="修改邮箱" href="http://wo.haodou.com/settings.php?do=account&t=email" target="_blank">修改邮箱</a>'+'</div>'+'</dd>'+'</dl>'+'</div>'+'<input type="hidden" name="cur_page_model" value="'+json['data']['tpl_params']+'" />'+'<input type="hidden" name="email" value="'+json['data']['email']+'" />'+'<input type="hidden" name="is_again" value="0" />'+'</form>';hd.dialog.popup('_common_check_email_send_model',tpl,true,function(tpl){$(tpl).find(".check_email_close").click(function(){hd.dialog.close('_common_check_email_send_model')})},function(tpl){var $check_email_send_agin=$(tpl).find('#check_email_send_agin');$check_email_send_agin.unbind('click').bind('click',function(){if($check_email_send_agin.hasClass('lock'))return false;$check_email_send_agin.addClass('lock');$(tpl).find("input[name='is_again']").val('1');sendEmail(tpl_params,json,true)});if(is_send){$(tpl).find("#common_check_email_hidden_form_3").submit()}})}};(function($){album_save={url:hd.base.root,_caption:function(type){$('.ins').click(function(){$('.ins_s').attr("style","display: ");$("#caption_"+$(this).attr('id')).attr("style","display:block")})},_changeSel:function(){var $obj=$('.rc_item_box');$obj.on("click",function(){$obj.removeClass('sel')});$obj.on("click",function(){$(this).addClass('sel')})},_checkWords:function(){var $obj_t=$("#Title");var $obj_c=$("#Contents");var $obj_i=$("#Intro");var $obj_t_num=$('#Title_num');var $obj_c_num=$('#Contents_num');var $obj_i_num=$('#Intro_num');$obj_t_num.text(typeof($obj_t.val())!='undefined'?$obj_t.val().length:0);$obj_c_num.text(typeof($obj_c.val())!='undefined'?$obj_c.val().length:0);$obj_t.on('keyup',function(e){$obj_t=$("#Title");$obj_t_num=$('#Title_num');$obj_t_num.text(typeof($obj_t.val())!='undefined'?$obj_t.val().length:0)});$obj_c.live('keyup',function(e){$obj_c=$("#Contents"),$obj_c_num=$('#Contents_num');$obj_c_num.text(typeof($obj_c.val())!='undefined'?$obj_c.val().length:0)});$obj_i.live('keyup',function(e){$obj_i=$("#Intro"),$obj_i_num=$('#Intro_num');$obj_i_num.text(typeof($obj_i.val())!='undefined'?$obj_i.val().length:0)})},_addTags:function(){$(document).on('click','#use_tags a',function(){var tag,arr,flag,$p=$("#Tags"),$p_val=$.trim($p.val()).replace('输入多个标签请用空格分开，如“主食 面食”','');tag=$(this).attr('title'),tmp="";var tagalt=$(this).attr('alt');if(tagalt>0){var tleft=$(this).offset().left-$("#Tags").offset().left;if(tleft<0){tleft=0}$('.rc_tag_exc').hide();$("#Pg_"+tagalt).css({"left":tleft});$("#Tg_"+tagalt).show()}if(tag==''){return}if($(this).hasClass('sel')){$('#use_tags a').each(function(){if($(this).html()==tag){$(this).removeClass('sel')}});if($p_val){$p_val=$p_val.replace(/[\u3000]/g," ");arr=$p_val.split(" ");$.each(arr,function(i,n){if(n!=tag){tmp+=n+" "}});$p.val($.trim(tmp))}else{$p_val=$p.val(tag)}}else{if($p_val){$p_val=$p_val.replace(/[\u3000]/g," ");arr=$p_val.split(" ");if(arr.length<5){if($.inArray(tag,arr)==-1){$p_val=$p.val($p_val+" "+tag)}$('#use_tags a').each(function(){console.log($(this).html(),tag);if($(this).html()==tag){$(this).addClass('sel')}})}else{hd.dialog.alert("最多可以选择5个标签");return false}return}else{$p_val=$p.val(tag);$('#use_tags a').each(function(){console.log($(this).html(),tag);if($(this).html()==tag){$(this).addClass('sel')}})}}})},_createAlbum:function(){var data={},$t=$('#Title'),$contents=$('#Contents'),$tags=$('#Tags'),$valicode=$("#mail_valicode"),$t_val=$.trim($t.val().replace("输入专辑标题",'')),$contents_val=$.trim($contents.val()),$tags_val=$.trim($tags.val()).replace("输入多个标签请用空格分开，如“主食 面食”",''),$valicode_val=$valicode.val();if($t_val==""){$('.rc_item_box').removeClass('sel');hd.dialog.alert("请填写标题!");$t.parent().addClass('sel');return false}if($t_val.length>20){$('.rc_item_box').removeClass('sel');hd.dialog.alert("标题,不能大于20个字符!");$t.parent().addClass('sel');return false}if($t_val!="输入专辑标题"){data.Title=$t_val}else{$('.rc_item_box').removeClass('sel');hd.dialog.alert("请填写标题!");$t.parent().addClass('sel');return false}if($contents_val.length>500){$('.rc_item_box').removeClass('sel');hd.dialog.alert("专辑介绍字数不能大于500!");$contents.parent().addClass('sel');return false}if($contents_val.length>0&&$contents_val!="输入专辑内容介绍"){data.Contents=$contents_val}if($valicode_val!=='undefined'&&$valicode_val==""){$('.rc_item_box').removeClass('sel');hd.dialog.alert("请填写验证码!");$valicode.parent().addClass('sel');return false}if($valicode_val!=='undefinde'){data.valicode=$valicode_val}var n={},r=[];if($tags_val.length>0){$tags_val=$tags_val.replace(/[\u3000]/g," ");var tags=$tags_val.length?$tags_val.split(' '):[],re=/^[\u4e00-\u9fa5|0-9a-z]{1,8}$/i;for(var i=0;i<tags.length;i++){if(!n[tags[i]]){if(!re.test(tags[i])){hd.dialog.alert('标签只能长度1到8个字符的数字、字母、汉字。');return false}n[tags[i]]=true;r.push(tags[i])}}}data.Tags=r.length>0?r.join(" "):"";$.ajax({type:"POST",url:album_save.url+"recipe/album/create.php?do=Save",data:$.param(data),dataType:'json',cache:false,success:function(res){if(res.flag==false){$('#img_code').click();hd.dialog.alert(res.msg)}else{hd.wealthTip();window.location.href=album_save.url+'recipe/album/'+res.flag+'/'}}});return false}};album_save._caption();album_save._changeSel();album_save._checkWords();album_save._addTags()})(jQuery);